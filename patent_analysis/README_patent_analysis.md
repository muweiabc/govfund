# 公司专利分析系统

## 概述
这个系统用于分析`filtered_companies.csv`中的公司在`trimpatent.csv`专利数据库中的专利情况，按年份统计每个公司获得的专利数量。

## 文件说明

### 主要脚本
1. **`company_patent_analysis.py`** - 完整的专利分析脚本
2. **`quick_patent_check.py`** - 快速数据检查脚本
3. **`trimpatent.py`** - 专利数据预处理脚本

### 数据文件
- **`filtered_companies.csv`** - 需要分析的公司列表（融资主体列）
- **`trimpatent.csv`** - 专利数据库（包含申请人、申请年份等列）

## 安装依赖
```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 快速检查数据（推荐先运行）
```bash
python quick_patent_check.py
```
这个脚本会：
- 检查数据文件是否存在
- 验证数据结构
- 测试小规模数据匹配
- 显示匹配率

### 2. 完整分析（处理全部数据）
```bash
python company_patent_analysis.py
```
这个脚本会：
- 读取所有公司数据（11,855家）
- 分块读取专利数据（节省内存）
- 构建稀疏矩阵存储结果
- 保存分析结果

### 3. 查询特定公司
```python
from company_patent_analysis import query_company_patents

# 查询特定公司的专利情况
patents = query_company_patents("北京蓝晶微生物科技有限公司")
```

## 输出文件

### 1. `company_patent_matrix.pkl`
- 稀疏矩阵格式的完整结果
- 包含公司名称、年份、索引映射等元数据
- 适合程序化查询和分析

### 2. `company_patent_yearly.csv`
- CSV格式的结果，便于Excel查看
- 行：公司名称
- 列：年份
- 值：该年专利数量

## 数据结构设计

### 稀疏矩阵的优势
- **内存效率**：由于大部分公司在大部分年份都没有专利，稀疏矩阵可以大幅节省内存
- **查询效率**：支持快速的行列查询
- **扩展性**：可以轻松添加更多公司和年份

### 矩阵结构
```
           2020  2021  2022  2023  2024  2025
公司1       5     3     7     2     1     0
公司2       0     2     0     1     0     0
公司3       1     0     0     0     3     2
...
```

## 性能特点

### 内存使用
- 使用分块读取避免一次性加载大文件
- 稀疏矩阵存储，只保存非零元素
- 预计内存使用：原始数据的5-10%

### 处理时间
- 快速检查：几秒钟
- 完整分析：取决于数据大小，预计10-30分钟

## 注意事项

1. **数据匹配**：公司名称必须完全匹配才能统计
2. **年份处理**：只统计有明确申请年份的专利
3. **内存管理**：大文件处理时建议关闭其他程序
4. **结果验证**：建议先用快速检查脚本验证数据质量

## 故障排除

### 常见问题
1. **文件不存在**：检查文件路径和文件名
2. **内存不足**：减少chunk_size或使用更小的测试数据
3. **编码问题**：确保CSV文件使用UTF-8编码

### 调试建议
1. 先运行`quick_patent_check.py`检查数据
2. 检查文件大小和格式
3. 验证公司名称是否完全匹配

## 扩展功能

### 可能的改进
1. **模糊匹配**：支持公司名称的模糊匹配
2. **专利类型分析**：按专利类型分类统计
3. **时间序列分析**：分析专利趋势
4. **可视化**：生成专利分布图表

### 数据源扩展
1. 支持更多专利数据库
2. 添加专利质量指标
3. 集成其他公司信息

